# Google OAuth Setup — Fundacio Predator Admin

## Overview
Google OAuth was configured so admin users can sign in to the admin panel at fundaciopredator.org/admin using their Google account, in addition to email/password login.

## Google Cloud Console Configuration

### OAuth Consent Screen
- Project: fundacio-predator (Google Cloud)
- App name: "Fundacio Predator Admin"
- User support email: arnd@predatorsl.com
- Audience: External
- Contact email: arnd@predatorsl.com
- Status: Testing mode (only test users can sign in — add users at console.cloud.google.com → APIs & Services → OAuth consent screen → Test users, or publish the app for production)

### OAuth 2.0 Client
- Name: "Fundacio Predator Admin"
- Type: Web Application
- Client ID: (stored in Supabase Auth Provider config + Google Cloud Console)
- Client Secret: (stored in Supabase Auth Provider config + Google Cloud Console)
- Authorized redirect URI: https://ahtbihxelpwrgcagdvkb.supabase.co/auth/v1/callback

## Supabase Configuration

### Auth Provider
- Google provider: Enabled
- Client ID and Secret: configured (same as above)
- Callback URL (auto-generated by Supabase): https://ahtbihxelpwrgcagdvkb.supabase.co/auth/v1/callback

### URL Configuration
- Site URL: https://fundaciopredator.org/admin/auth/callback
- Redirect URLs:
  1. https://www.fundaciopredator.org/admin/auth/callback
  2. https://fundaciopredator.org/admin/auth/callback
  3. https://fundacio-predator.vercel.app/admin/auth/callback

## Auth Flow
1. User clicks "Mit Google anmelden" on /admin/login
2. Supabase redirects to Google OAuth consent screen
3. After Google auth, redirects to Supabase callback (https://ahtbihxelpwrgcagdvkb.supabase.co/auth/v1/callback)
4. Supabase redirects to the app's callback route (/admin/auth/callback)
5. The callback route (`app/admin/auth/callback/route.ts`) exchanges the code for a session
6. It checks if the user exists in `fundacio_admin_users` table (by auth_uid or email)
7. If found, redirects to /admin; if not, shows "not_authorized" error

## Important Notes
- The Google OAuth consent screen is in TESTING mode. Only explicitly added test users can sign in. To allow all users: publish the app in Google Cloud Console → APIs & Services → OAuth consent screen → PUBLISH APP.
- The auth callback (`app/admin/auth/callback/route.ts`) matches admin users by `auth_uid` first, then falls back to email matching and auto-links the Google auth_uid to the existing admin user record.
- Admin authorization is separate from Supabase auth: users must exist in the `fundacio_admin_users` table OR their email must be in the `ADMIN_MAIL` environment variable.

## Links
- Google Cloud Console: https://console.cloud.google.com/apis/credentials
- Supabase Dashboard: https://supabase.com/dashboard/project/ahtbihxelpwrgcagdvkb/auth/providers
- Supabase URL Config: https://supabase.com/dashboard/project/ahtbihxelpwrgcagdvkb/auth/url-configuration
